////
/// @group o-forms
/// @link http://registry.origami.ft.com/components/o-forms
////

/// Common field styles
@mixin oFormsCommonFieldBase {
	@include oColorsFor(o-forms-field-standard);
	@include oTypographySize($_o-forms-typography-scale-regular);
	margin-top: $_o-forms-spacing;
	box-sizing: border-box;
	width: 100%;
	max-width: $_o-forms-field-max-width;
	height: $_o-forms-field-default-height;
	padding: $_o-forms-field-default-padding-top $_o-forms-field-default-padding-leftright $_o-forms-field-default-padding-bottom;
	border: $_o-forms-field-border;
	border-radius: $_o-forms-field-border-radius;
	background-clip: padding-box;
	font-family: $o-forms-font-family;
	outline: none;
	transition: 0.15s box-shadow ease-in;

	// sass-lint:disable no-vendor-prefixes
	-moz-appearance: none;
	-webkit-appearance: none;
	// sass-lint:enable no-vendor-prefixes

	&:focus {
		@include oFormsCommonFieldFocus;
	}

	&:disabled {
		@include oFormsCommonFieldDisabled;
	}

	&::placeholder {
		@include oColorsFor(o-forms-field-placholder);
	}
}

/// Common field styles: focused state only
@mixin oFormsCommonFieldFocus {
	@include oColorsFor(o-forms-field-focus);
	box-shadow: 0 0 0 2px $o-normalise-focus-color;
}

/// Common field styles: disabled state
@mixin oFormsCommonFieldDisabled {
	@include oColorsFor(o-forms-field-disabled);
	cursor: default;
}

/// Common field styles: invalid state
@mixin oFormsCommonFieldInvalid {
	@include oColorsFor(o-forms-field-invalid);

	&:focus {
		box-shadow: 0 0 0 2px oColorsGetColorFor(o-forms-field-invalid, border);
	}
}

/// Common field styles: valid state
@mixin oFormsCommonFieldValid {
	@include oColorsFor(o-forms-field-valid);
	background-color: rgba(oColorsGetColorFor(o-forms-field-valid, background), 0.05);
}

/// Common field styles: small
@mixin oFormsCommonSmall {
	height: $_o-forms-field-small-height;
	padding-top: 0;
	padding-bottom: 2px;
	background-size: $_o-forms-select-small-iconsize $_o-forms-select-small-iconsize;
	background-position-x: 99%; // Make the smaller icon size visually match the padding on the left of the input
	line-height: $_o-forms-field-small-height - ($_o-forms-field-border-width * 2);
}


/// Group styles
@mixin oFormsGroup($selectors: (radio: '.o-forms__radio', checkbox: '.o-forms__checkbox', label: '.o-forms__label')) {
	$checkbox: unquote(map-get($selectors, checkbox));
	$radio: unquote(map-get($selectors, radio));
	$label: unquote(map-get($selectors, label));
	position: relative;
	max-width: $_o-forms-field-max-width;
	margin: 0 0 $_o-forms-group-spacing; // Reset top and side margins for fieldset usage
	// reset <fieldset> defaults
	padding: 0;
	border: 0;

	// sass-lint:disable mixins-before-declarations
	@include _oFormsBreakpoint {
		padding-right: $_o-forms-padding;
		padding-left: $_o-forms-padding;
	}
	// sass-lint:enable mixins-before-declarations

	&--wide {
		@include oFormsFullWidth;
	}

	&__checkboxes,
	&__radios {
		margin: 0 0 #{-$_o-forms-spacing};
		#{$radio} + #{$label},
		#{$checkbox} + #{$label} {
			width: 100%; // We do not use display:block to maintain consistent margins (not collapsed).
			box-sizing: border-box;
		}
		&--inline {
			#{$radio} + #{$label},
			#{$checkbox} + #{$label} {
				width: auto;
			}
		}
	}

	&__checkboxes + &__errortext,
	&__radios + &__errortext {
		@include _oFormsRadioCheckboxErrorText();
	}
}

/// All the field to extend to the full width
/// of the container
@mixin oFormsFullWidth() {
	// sass-lint:disable no-important
	max-width: none !important;
	// sass-lint:enable no-important
}

/// Target styles at Internet Explorer 8 only
@mixin _oFormsTargetIE8 {
	@media \0screen {
		@content;
	}
}

/// Target both IE8 and modern browsers at the breakpoint
/// Useful for layout changes at the Small breakpoint
@mixin _oFormsBreakpoint {
	@include oGridRespondTo(S) {
		@content;
	}
	@include oGridTargetIE8 {
		@content;
	}
}

// From: https://css-tricks.com/snippets/sass/str-replace-function/
/// Replace `$search` with `$replace` in `$string`
/// @author Hugo Giraudel
/// @param {String} $string - Initial string
/// @param {String} $search - Substring to replace
/// @param {String} $replace ('') - New value
/// @return {String} - Updated string
@function str-replace($string, $search, $replace: '') {
  $index: str-index($string, $search);

  @if $index {
    @return str-slice($string, 1, $index - 1) + $replace + str-replace(str-slice($string, $index + str-length($search)), $search, $replace);
  }

  @return $string;
}
